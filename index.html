<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R69 é«˜é€Ÿå…¬è·¯ç¥å»Ÿ - å…é©—è­‰ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #ff2a6d;
            --secondary: #05d9e8;
            --bg: #1a1a2e;
            --card-bg: #16213e;
            --text: #e94560;
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg);
            color: #fff;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: radial-gradient(#2a2a4e 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .container {
            width: 90%;
            max-width: 450px;
            text-align: center;
        }

        /* Logo æ¨£å¼ */
        .logo-img {
            height: 48px;
            margin-bottom: 0px;
            transition: transform 0.3s;
        }
        .logo-img:hover {
            transform: scale(1.05);
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--secondary);
            text-shadow: 0 0 10px rgba(5, 217, 232, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        /* ç™»å…¥å€å¡Š */
        #login-section {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid var(--primary);
            box-shadow: 0 0 20px rgba(255, 42, 109, 0.2);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* æ–°å¢ï¼šè¼¸å…¥æ¡†æ¨£å¼ */
        .name-input {
            width: 80%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--secondary);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1rem;
            text-align: center;
            outline: none;
            margin: 0 auto;
        }
        .name-input:focus {
            box-shadow: 0 0 10px rgba(5, 217, 232, 0.3);
        }

        .start-btn {
            background-color: var(--secondary);
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background 0.3s, transform 0.2s;
            text-decoration: none;
            width: 80%;
            margin: 0 auto;
        }
        .start-btn:hover { 
            background-color: #04b0bc; 
            transform: scale(1.02);
        }

        /* æ±‚ç±¤æ©Ÿæœ¬é«” */
        .fortune-machine {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 2px solid #333;
            position: relative;
            overflow: hidden;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .hidden { display: none !important; }

        /* Tenga ç±¤ç­’åœ–ç‰‡æ¨£å¼ */
        .tenga-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px auto;
            position: relative;
        }

        .tenga-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 10px rgba(255, 42, 109, 0.3));
        }

        .user-footer {
            margin-top: 25px; 
            display: flex;
            justify-content: center; 
            align-items: center;
            width: 100%;
            min-height: 50px;
        }

        .btn-draw {
            background: linear-gradient(45deg, var(--primary), #d62259);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem; 
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 42, 109, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px; 
        }

        .btn-draw:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 42, 109, 0.6);
        }

        .btn-draw:active { transform: scale(0.95); }

        .btn-draw:disabled {
            filter: grayscale(0.8);
            cursor: not-allowed;
            transform: none;
        }

        /* Result Styles */
        .result-card {
            width: 100%;
            animation: fadeIn 0.5s ease-out;
        }

        .result-number { font-size: 0.9rem; color: #888; margin-bottom: 5px; letter-spacing: 2px; }
        .result-type { font-size: 1.5rem; color: var(--secondary); font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; display: inline-block; }
        .result-type.king { color: #ffd700; text-shadow: 0 0 10px #ffd700; }
        .result-title { font-size: 1.3rem; margin: 15px 0; color: #fff; font-weight: bold; }
        .result-box { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: left; border-left: 4px solid var(--primary); }
        
        .result-label { font-size: 0.85rem; color: #aaa; display: flex; align-items: center; gap: 6px; margin-bottom: 5px; }
        .result-label i { color: var(--secondary); } 
        
        .result-text { font-size: 1rem; line-height: 1.5; color: #eee; }
        .warning-text { border-left-color: var(--secondary); }
        .warning-text .result-label i { color: #ffd700; }

        /* æ–°å¢ï¼šçµæœé é¢é¡¯ç¤ºå§“åçš„æ¨£å¼ */
        .seeker-name {
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        .shaking { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-1deg); }
            20%, 80% { transform: translate3d(2px, 0, 0) rotate(2deg); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0) rotate(-4deg); }
            40%, 60% { transform: translate3d(4px, 0, 0) rotate(4deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>
        <a href="https://discord.gg/Hw7aVwDXwj" ><img src="r69.png" alt="R69 Logo" class="logo-img"> </a>
        ç¥å»Ÿæ±‚é›ç·£ç³»çµ±
    </h1>

    <div id="login-section">
        <p>æ­¡è¿ä¾†åˆ° R69 é«˜é€Ÿå…¬è·¯ç¥å»Ÿ</p>
        <p style="font-size:0.9rem; color:#aaa;">è«‹è¼¸å…¥æ‚¨çš„åå­—ä»¥é–‹å§‹æ±‚ç±¤</p>
        
        <input type="text" id="username-input" class="name-input" placeholder="è«‹è¼¸å…¥æš±ç¨±" maxlength="10">
        
        <button onclick="handleGuestLogin()" class="start-btn">
            <i class="fa-solid fa-play"></i> é–‹å§‹æ±‚ç±¤
        </button>
    </div>

    <div class="fortune-machine hidden" id="machine">
        
        <div id="start-view">
            <div class="tenga-container" id="stick-icon">
                <img src="toss.png" alt="Tenga Fortune" class="tenga-img">
            </div>
            <p style="color: #aaa; margin-bottom: 20px;">èª å¿ƒç¥ˆæ±‚ï¼Œå®‡å®™å°‡çµ¦ä½ 30å…¬åˆ†æˆ–æ›´å¤š</p>
            <button class="btn-draw" onclick="drawFortune()">
                <i class="fa-solid fa-wand-magic-sparkles"></i> é–‹å§‹æ±‚ç±¤
            </button>
        </div>

        <div id="result-view" class="result-card hidden">
            
            <div id="capture-target" style="padding: 20px; border-radius: 15px; background: transparent; border: 1px solid rgba(255,255,255,0.1);">
              <div style="display: flex; align-items: center; justify-content: center; gap: 10px;  padding-bottom: 10px;padding-top: 10px; ">
                    <img src="r69.png" style="height: 35px; width: auto; ">
                </div>

                <div class="seeker-name" id="r-username">æ±‚ç±¤è€…ï¼šXXX</div>

                <div class="result-number" id="r-number">ã€ç¬¬XXé¦–ã€‘</div>
                <div class="result-type" id="r-type">é¡å‹</div>
                <h2 class="result-title" id="r-title">æ¨™é¡Œ</h2>
                
                <div class="result-box">
                    <span class="result-label"><i class="fa-solid fa-book-open"></i> çŸ¥è­˜</span>
                    <div class="result-text" id="r-knowledge">å…§å®¹...</div>
                </div>

                <div class="result-box warning-text">
                    <span class="result-label"><i class="fa-solid fa-lightbulb"></i> å°æé†’</span>
                    <div class="result-text" id="r-reminder">å…§å®¹...</div>
                </div>
                
                <div style="text-align: center; margin-top: 15px; font-size: 0.7rem; color: #666;">
                    R69 é«˜é€Ÿå…¬è·¯ by r-Xing é˜¿æ€§æƒ…è¶£
                </div>
            </div>
            <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
                <button id="btn-download" class="btn-draw" style="background: #333; font-size: 1rem;" onclick="downloadImage()">
                    <i class="fa-solid fa-camera"></i> ä¿å­˜çµæœåœ–ç‰‡
                </button>
                <button class="btn-draw" style="background: transparent; border: 1px solid #555; font-size: 0.9rem;" onclick="location.reload()">
                    <i class="fa-solid fa-rotate-right"></i> é‡ç½® / æ›äººç©
                </button>
            </div>
        </div>
    </div>
   
    <div id="user-display" class="user-footer"></div>
    

</div>


<script>
    // ================= CONFIG è¨­å®šå€ =================
    // Google Script ç¶²å€ (ç¶­æŒåŸæ¨£)
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwu17WdLCGCGXLS8KHRVd28saBkiP9hlAs6yZ5CoCfS7xQ1BX8rwqyjkqrMG9ox42TWLA/exec'; 
    // ================================================

    // å®Œæ•´çš„ç±¤è©©è³‡æ–™åº« (ç¶­æŒåŸæ¨£)
    const fortunes = [
        { id: "01", type: "å°é›", title: "ç„¡ç—›é€²å…¥çš„æº«æŸ”ç´³å£«", knowledge: "ä¸éœ€è¦æ¼«é•·ç—›è‹¦çš„æ“´å¼µéç¨‹ï¼Œéš¨æ™‚éƒ½èƒ½æ»‘é †é€²å ´", reminder: "é€™èƒ½å¤§å¹…é™ä½ä¼´ä¾¶çš„ä¸é©æ„Ÿï¼Œé©åˆå¿«é€Ÿé€²å…¥ç‹€æ³çš„æ—©æ™¨" },
        { id: "02", type: "å¤§èƒ¸", title: "ä»¤äººçª’æ¯çš„æ·±æµ·æ“æŠ±", knowledge: "æ·±åŸ‹å…¶ä¸­èƒ½æœ‰æ•ˆé˜»éš”å¤–ç•Œå™ªéŸ³ï¼Œé”åˆ°å†¥æƒ³æ•ˆæœ", reminder: "è«‹æ³¨æ„å°æ–¹çš„å‘¼å¸é“æš¢é€šï¼Œæ„›æ˜¯æ²ˆé‡çš„ç”œèœœè² æ“”" },
        { id: "03", type: "å¤§èƒ¸", title: "åœ°å¿ƒå¼•åŠ›çš„å°æŠ—è€…", knowledge: "å¤§å°ºå¯¸å¸¶ä¾†çš„è¦–è¦ºè¡æ“Šèƒ½ç¬é–“æå‡è…¦å…§å¤šå·´èƒº", reminder: "é›–ç„¶å¾ˆå£¯è§€ï¼Œä½†èƒŒéƒ¨æŒ‰æ‘©æ˜¯é€™é¡ä¼´ä¾¶æœ€éœ€è¦çš„ç¦®ç‰©" },
        { id: "04", type: "å¤§èƒ¸", title: "æŸ”è»Ÿçš„å¤¢å¢ƒæ•é ­", knowledge: "æ“šèªªèººåœ¨ä¸Šé¢å…¥ç¡ï¼Œå¤±çœ æ²»ç™’ç‡é«˜é” 99%", reminder: "æº«æŸ”é„‰æ˜¯è‹±é›„å¡šï¼Œå°å¿ƒèˆ’æœåˆ°å¿˜è¨˜è¾¦æ­£äº‹" },
        { id: "05", type: "å¤§èƒ¸", title: "å……æ»¿æ¯æ€§çš„åŒ…å®¹åŠ›", knowledge: "é€™ä»½æŸ”è»Ÿèƒ½æ¿€ç™¼äººé¡æœ€åŸå§‹çš„å®‰å…¨æ„Ÿèˆ‡ä¾æˆ€", reminder: "æ’’å¬Œæ¯”ç¡¬ç¢°ç¡¬æ›´æœ‰ç”¨ï¼Œä»Šæ™šè©¦è‘—ç•¶å€‹å¤§å­©å­å§" },
        { id: "06", type: "å¤§èƒ¸", title: "æ³¢å‹•æ‹³çš„å‚³æ‰¿è€…", knowledge: "ç‰©ç†æ…£æ€§æœƒç”¢ç”Ÿé©šäººçš„æ™ƒå‹•ç¾å­¸ï¼Œé€™æ˜¯å¤§è‡ªç„¶çš„å¥‡è¹Ÿ", reminder: "é‹å‹•æ™‚è«‹æº–å‚™é«˜æ”¯æ’æ€§çš„è£å‚™ï¼Œä¿è­·é€™ä»½çè²´çš„è³‡ç”¢" },
        { id: "07", type: "èƒ¸", title: "é»ƒé‡‘æ¯”ä¾‹çš„å®Œç¾ä¸»ç¾©", knowledge: "ç¬¦åˆäººé«”å·¥å­¸çš„æ‰‹æ„Ÿï¼Œä¸å¤šä¸å°‘å‰›å‰›å¥½å¡«æ»¿æŒå¿ƒ", reminder: "é€™æ˜¯æœ€é©åˆå„ç¨®æœè£çš„è¡£æ¶å­ï¼Œè«‹å¤šå˜—è©¦ä¸åŒé¢¨æ ¼" },
        { id: "08", type: "èƒ¸", title: "æ‰‹æŒå¿ƒçš„æœ€ä½³æ‹æª”", knowledge: "Cåˆ°Dç½©æ¯æ˜¯çµ±è¨ˆå­¸ä¸Šæœ€å—æ­¡è¿çš„ã€Œæ™®ä¸–åƒ¹å€¼ã€", reminder: "é›–æ²’æœ‰æ¥µç«¯çš„è¦–è¦ºè¡æ“Šï¼Œä½†è€çœ‹åº¦èˆ‡å¯¦ç”¨æ€§æ˜¯æœ€é«˜çš„" },
        { id: "09", type: "èƒ¸", title: "å½ˆæ€§èˆ‡å½¢ç‹€çš„å¹³è¡¡é»", knowledge: "è„‚è‚ªèˆ‡ä¹³è…ºæ¯”ä¾‹é©ä¸­ï¼Œé€šå¸¸æ“æœ‰æœ€å®Œç¾çš„æŒºæ‹”åº¦", reminder: "ç„¡è«–æ˜¯èººè‘—é‚„æ˜¯ç«™è‘—ï¼Œéƒ½èƒ½ä¿æŒå„ªç¾çš„å½¢ç‹€" },
        { id: "10", type: "èƒ¸", title: "éš±è—å¯¦åŠ›çš„æ½›åŠ›è‚¡", knowledge: "ç©¿è¡£é¡¯ç˜¦è„«è¡£æœ‰è‚‰ï¼Œèƒ½çµ¦äºˆå°æ–¹é©šå–œçš„åå·®æ„Ÿ", reminder: "å…§è¡£çš„é¸æ“‡æ±ºå®šäº†ä»Šå¤©çš„æˆ°é¬¥åŠ›ï¼Œé›†ä¸­æ‰˜é«˜æ•ˆæœé©šäºº" },
        { id: "11", type: "èƒ¸", title: "æ°åˆ°å¥½è™•çš„æº«æŸ”é„‰", knowledge: "ä¸æœƒå› ç‚ºéé‡é€ æˆè² æ“”ï¼Œä¹Ÿä¸æœƒè®“äººæ„Ÿåˆ°ç©ºè™›", reminder: "é©åˆé•·æ™‚é–“çš„æ“æŠ±èˆ‡è¦ªå¯†æ¥è§¸ï¼Œé«”æº«å‚³éæ•ˆç‡æ¥µä½³" },
        { id: "12", type: "èƒ¸", title: "å´ä¹³ç¾å­¸çš„æ•™ç§‘æ›¸", knowledge: "å¾®å¾®éœ²å‡ºçš„å´é‚Šç·šæ¢ï¼Œæ®ºå‚·åŠ›å¾€å¾€æ¯”æ­£é¢æ›´é«˜", reminder: "é¸æ“‡ä¸€ä»¶å¤§è¢–å£çš„èƒŒå¿ƒï¼Œå±•ç¾è‹¥éš±è‹¥ç¾çš„èª˜æƒ‘" },
        { id: "13", type: "èƒ¸", title: "æŒæ¡ç¯€å¥çš„æŒ‡æ®å®¶", knowledge: "é‡é‡é©ä¸­ï¼Œéš¨å‹•ä½œæ™ƒå‹•çš„å¹…åº¦æœ€å¯Œæœ‰éŸ»å¾‹æ„Ÿ", reminder: "åœ¨é¨ä¹˜ä½æ™‚èƒ½å±•ç¾æœ€ä½³çš„å‹•æ…‹å¹³è¡¡ï¼Œè«‹å¤šåŠ åˆ©ç”¨" },
        { id: "14", type: "èƒ¸", title: "å±…å®¶æ—…è¡Œå¿…å‚™è‰¯ä¼´", knowledge: "ä¸æœƒå°è‚©é ¸é€ æˆå£“åŠ›ï¼Œæ˜¯é•·ä¹…é—œä¿‚ä¸­æœ€èˆ’é©çš„é¸æ“‡", reminder: "ç´°æ°´é•·æµçš„å¹¸ç¦ï¼Œä¾†è‡ªæ–¼é€™ä»½æ°å¦‚å…¶åˆ†çš„å‰›å¥½" },
        { id: "15", type: "èƒ¸", title: "è§¸è¦ºç³»çš„é ‚ç´šäº«å—", knowledge: "é€™ä»½é£½æ»¿åº¦æœ€é©åˆæ‰æï¼Œæ‰‹æ„Ÿå›é¥‹æ¥µä½³", reminder: "æ¯”èµ·è§€è³ï¼Œé€™æ˜¯ä¸€å€‹æ›´é©åˆã€Œä¸Šæ‰‹ã€çš„å°ºå¯¸" },
        { id: "16", type: "èƒ¸", title: "å…©æ‰‹æŒæ¡çš„å¹¸ç¦", knowledge: "äººé¡é›™æ‰‹åˆåçš„ç©ºé–“å‰›å¥½èƒ½å®Œç¾åŒ…è¦†", reminder: "é€™æ˜¯ä¸Šå¸ç‚ºäº†æ“æŠ±è€Œè¨­è¨ˆçš„å°ºå¯¸ï¼Œè«‹ç›¡æƒ…æ„Ÿå—é«”æº«" },
        { id: "17", type: "å°èƒ¸", title: "é›¢å¿ƒè·³æœ€è¿‘çš„è·é›¢", knowledge: "è„‚è‚ªå±¤è¼ƒè–„ï¼Œå¿ƒè·³è²èƒ½æ›´ç›´æ¥åœ°å‚³éçµ¦æ“æŠ±çš„äºº", reminder: "ç·Šç·Šç›¸æ“æ™‚çš„å…±é³´æ„Ÿæ˜¯å…¶ä»–å°ºå¯¸ç„¡æ³•æ¯”æ“¬çš„" },
        { id: "18", type: "å°èƒ¸", title: "é«˜æ•æ„Ÿçš„é›·é”ç«™", knowledge: "ç¥ç¶“æœ«æ¢¢åˆ†ä½ˆå¯†åº¦é«˜ï¼Œæ•æ„Ÿåº¦å¾€å¾€æ˜¯æ‰€æœ‰å°ºå¯¸ä¹‹å† ", reminder: "è¼•è¼•çš„è§¸ç¢°å°±èƒ½å¼•ç™¼å…¨èº«é¡«æ…„ï¼Œå‰æˆ²è«‹å‹™å¿…æº«æŸ”" },
        { id: "19", type: "å°èƒ¸", title: "æ™‚å°šç•Œçš„è¶…ç´šåæ¨¡", knowledge: "é€™æ˜¯æœ€é«˜ç´šçš„High Fashionèº«æï¼Œç©¿ä»€éº¼éƒ½è‡ªå¸¶ä»™æ°£", reminder: "è©¦è©¦çœ‹ä¸ç©¿å…§è¡£æˆ–ç©¿è‘—å¯¬é¬†ç™½è¥¯è¡«ï¼Œæ€§æ„ŸæŒ‡æ•¸ç ´è¡¨" },
        { id: "20", type: "å°èƒ¸", title: "æ°¸ä¸å‚å¢œçš„é’æ˜¥", knowledge: "åœ°å¿ƒå¼•åŠ›å°ä½ ç„¡æ•ˆï¼Œåˆ°äº†å…«åæ­²ä¾ç„¶æŒºæ‹”å¦‚åˆ", reminder: "ä½ æ˜¯æ™‚é–“çš„è´å®¶ï¼Œæ°¸é ä¿æŒè‘—å°‘å¥³èˆ¬çš„è¼•ç›ˆé«”æ…‹" },
        { id: "21", type: "å°èƒ¸", title: "ç²¾ç·»çš„é¦™æª³é…’æ¯", knowledge: "å°å·§ç²ç“çš„å½¢ç‹€å¦‚åŒè—è¡“å“ï¼Œé©åˆç´°ç´°å“å‘³", reminder: "ä¸è¦ç”¨è »åŠ›ï¼Œé€™æ˜¯éœ€è¦ç”¨èˆŒå°–èˆ‡æŒ‡å°–å‘µè­·çš„çå¯¶" },
        { id: "22", type: "å°èƒ¸", title: "æ¿€èµ·ä¿è­·æ¬²çš„é–‹é—œ", knowledge: "çº–ç´°çš„ç·šæ¢èƒ½ç¬é–“æ¿€ç™¼ä¼´ä¾¶æœ€å¼·çƒˆçš„å¾æœèˆ‡ä¿è­·æ…¾", reminder: "é©åº¦çš„ç¤ºå¼±èˆ‡å¬Œå–˜ï¼Œèƒ½è®“æˆ°é¬¥åŠ›å€å¢" },
        { id: "23", type: "å°èƒ¸", title: "èƒŒå½±æ®ºæ‰‹çš„ç§˜å¯†æ­¦å™¨", knowledge: "é€šå¸¸æ­é…è‘—çº–ç´°çš„è…°èº«èˆ‡ç¾èƒŒï¼Œè¦–è¦ºç„¦é»åœ¨æ–¼æ•´é«”ç·šæ¢", reminder: "éœ²å‡ºä½ çš„è´è¶éª¨èˆ‡è„Šæ¤æºï¼Œé‚£æ˜¯å¦ä¸€å€‹æ€§æ„Ÿå¸¶" },
        { id: "24", type: "å°èƒ¸", title: "æŒå¿ƒè£¡çš„ç å¯¶", knowledge: "ä¸€æ‰‹æŒæ¡ä¸å®Œä¸ç®—ä»€éº¼ï¼Œèƒ½å®Œå…¨åŒ…è¦†æ‰æ˜¯æ¥µè‡´çš„ä½”æœ‰", reminder: "è®“å°æ–¹çš„æ‰‹å®Œå…¨è¦†è“‹ï¼Œæ„Ÿå—é‚£ä»½å®Œå…¨å±¬æ–¼ä»–çš„å®‰å¿ƒæ„Ÿ" },
        { id: "25", type: "å°èƒ¸", title: "æ•æ„Ÿå¸¶çš„æ“´æ•£æ•ˆæ‡‰", knowledge: "å› ç‚ºèƒ¸éƒ¨æ•æ„Ÿåº¦é«˜ï¼Œå¿«æ„Ÿå®¹æ˜“æ“´æ•£è‡³å…¨èº«èˆ‡ä¹³é ­", reminder: "å°ˆæ”»é€™ä¸€é»ï¼Œå¾€å¾€èƒ½æ¯”ç›´æ¥é€²æ”»ä¸‹åŠèº«æ›´å¿«é€²å…¥ç‹€æ³" },
        { id: "26", type: "å°èƒ¸", title: "è¼•ç›ˆçš„ç©ºæ°£åŠ›å­¸", knowledge: "é‹å‹•æ™‚æ¯«ç„¡è² æ“”ï¼Œè®“ä½ åœ¨å„ç¨®é«˜é›£åº¦é«”ä½ä¸­éˆæ´»è‡ªå¦‚", reminder: "å±•ç¾ä½ çš„æŸ”è»Ÿåº¦èˆ‡é«”åŠ›ï¼Œé€™æ˜¯ä¸»å ´å„ªå‹¢" },
        { id: "27", type: "å°èƒ¸", title: "éª¨æ„Ÿçš„æ€§æ„Ÿç¾å­¸", knowledge: "é–éª¨èˆ‡èƒ¸éª¨çš„ç·šæ¢ç¾ï¼Œæ˜¯è‚‰æ„Ÿç„¡æ³•å–ä»£çš„é«˜ç´šè‰²æ°£", reminder: "åœ¨é–éª¨æ”¾ä¸Šä¸€é¡†è‰è“ï¼Œè¦–è¦ºæ•ˆæœæœƒéå¸¸é©šäºº" },
        { id: "28", type: "å°èƒ¸", title: "è˜¿è‰å¡”çš„å¤¢å¹»é«”è³ª", knowledge: "è‡ªå¸¶æ¸›é½¡æ¿¾é¡ï¼Œä¸ç®¡å¹¾æ­²éƒ½ä¿æœ‰æ¸…ç´”èˆ‡èª˜æƒ‘ä¸¦å­˜çš„ç‰¹è³ª", reminder: "æ­é…éè†è¥ªæˆ–ç‰¹å®šæœè£ï¼Œèƒ½é–‹å•Ÿæ–°ä¸–ç•Œçš„å¤§é–€" },
        { id: "29", type: "å°èƒ¸", title: "é›¶è·é›¢çš„è²¼åˆæ„Ÿ", knowledge: "åœ¨æ“æŠ±æ™‚ï¼Œå…©äººçš„èº«é«”èƒ½é”åˆ°çœŸæ­£çš„ç„¡ç¸«è²¼åˆ", reminder: "æ„Ÿå—å½¼æ­¤çš®è†šçš„æœ€å¤§æ¥è§¸é¢ç©ï¼Œé€™æ˜¯æœ€è¦ªå¯†çš„æ™‚åˆ»" },
        { id: "30", type: "å°èƒ¸", title: "æŒ‘é€—ç¥ç¶“çš„ç´°ç¯€", knowledge: "å› ç‚ºé¢ç©å°ï¼Œå°æ–¹æœƒæ›´å°ˆæ³¨æ–¼æ„›æ’«æ¯ä¸€å€‹ç´°å¾®ä¹‹è™•", reminder: "å¼•å°å°æ–¹çš„æ‰‹æŒ‡ç•«åœˆï¼Œäº«å—è¢«ç´°å¿ƒå°å¾…çš„éç¨‹" },
        { id: "31", type: "å°èƒ¸", title: "ç¨ä¸€ç„¡äºŒçš„å¾®ä¹³éŸ»å‘³", knowledge: "å¾®ä¹³åœ¨å¤å¸Œè‡˜è—è¡“ä¸­è¢«è¦–ç‚ºé’æ˜¥èˆ‡ç¥æ€§çš„è±¡å¾µ", reminder: "è‡ªä¿¡å°±æ˜¯æœ€å¥½çš„åŒ–å¦å“ï¼Œä½ çš„ç¾æ˜¯å¤å…¸ä¸”æ°¸æ†çš„" },
        { id: "32", type: "å°é›", title: "ä½ æ˜¯èƒ½å·è¥²çš„éˆå·§å‹", knowledge: "å°å°ºå¯¸ç²¾æº–åº¦é«˜æ›´å®¹æ˜“å‘½ä¸­æ•æ„Ÿé»", reminder: "ç²¾æº–æ¯”ç”¨åŠ›æ›´èƒ½é€ æˆè‡´å‘½å¸å¼•" },
        { id: "33", type: "ç±¤ç‹", title: "å‚³èªªä¸­çš„æ¥µæ¨‚å¤©å°Š", knowledge: "ä½ æ˜¯è¬ä¸­é¸ä¸€çš„å¤©é¸ä¹‹äººï¼Œè¶…è¶Šäº†å°ºå¯¸èˆ‡å½¢ç‹€çš„é™åˆ¶", reminder: "ä»Šæ™šä¸ç”¨åšé¸æ“‡ï¼Œå› ç‚ºä½ å…¨éƒ½è¦ï¼Œè«‹æº–å‚™å¥½è¶³å¤ çš„é«”åŠ›" },
        { id: "34", type: "å°é›", title: "é›™ç®¡é½Šä¸‹çš„æˆ°è¡“å¤§å¸«", knowledge: "å› ç‚ºé«”ç©ç²¾å·§ï¼Œç•™å‡ºäº†è¶³å¤ çš„ç©ºé–“çµ¦æ‰‹æŒ‡æˆ–ç©å…·åŒæ™‚é€²æ”»", reminder: "å–„ç”¨ã€Œå¤šæ ¸å¿ƒé‹ç®—ã€ï¼ŒåŒæ™‚åˆºæ¿€å¤šå€‹é»æ‰æ˜¯ç‹é“" },
        { id: "35", type: "å°é›", title: "èˆŒç²²è“®èŠ±çš„å£æŠ€å°ˆå®¶", knowledge: "ä¸Šå¸é—œäº†ä¸€æ‰‡é–€æœƒé–‹ä¸€æ‰‡çª—ï¼Œé€šå¸¸ä¼´éš¨è‘—å¼·å¤§çš„å£èˆŒå¤©è³¦", reminder: "ç•¶ä½ çš„èˆŒé ­æ¯”æœ¬é«”é‚„éˆæ´»æ™‚ï¼Œæ²’äººæœƒåœ¨æ„å°ºå¯¸" },
        { id: "36", type: "å°é›", title: "å¾Œåº­èŠ±åœ’çš„æ¢éšªå®¶", knowledge: "é€™æ˜¯æ¢ç´¢å¾Œåº­æœ€å®‰å…¨çš„å°ºå¯¸ï¼Œä¸æ˜“é€ æˆå—å‚·æˆ–æ’•è£‚", reminder: "å¦‚æœå°æ–¹å°å¾Œé–€é–‹ç™¼æœ‰èˆˆè¶£ï¼Œä½ æ˜¯æœ€æ£’çš„å…¥é–€å°å¸«" },
        { id: "37", type: "å°é›", title: "é«˜é »æŒ¯å‹•çš„é›»å‹•é¦¬é”", knowledge: "è³ªé‡è¼•æ‰€ä»¥æ…£æ€§å°ï¼Œè…°éƒ¨æ“ºå‹•çš„é »ç‡å¯ä»¥é”åˆ°æ¥µé™", reminder: "ç”¨å¿«åˆ°çœ‹ä¸è¦‹çš„æ®˜å½±é€Ÿåº¦ï¼Œå¾æœå°æ–¹çš„æ„Ÿå®˜å§" },
        { id: "38", type: "å°é›", title: "æ·±å–‰åš¨çš„å‹å–„å¤§ä½¿", knowledge: "é€™æ˜¯å”¯ä¸€èƒ½è®“å°æ–¹è¼•é¬†å±•ç¾ã€Œæ·±å–‰åš¨ã€ç‰¹æŠ€è€Œä¸åèƒƒçš„å°ºå¯¸", reminder: "äº«å—è¢«å®Œå…¨åæ²’çš„è¦–è¦ºèˆ‡è§¸è¦ºå¿«æ„Ÿï¼Œé€™æ˜¯ä½ çš„å°ˆå±¬ç¦åˆ©" },
        { id: "39", type: "å°é›", title: "æŒä¹…æˆ°çš„é¦¬æ‹‰æ¾é¸æ‰‹", knowledge: "è¡€æ¶²å……ç›ˆæ‰€éœ€é‡è¼ƒå°‘ï¼Œå¾€å¾€èƒ½ç¶­æŒæ›´é•·æ™‚é–“çš„ç¡¬åº¦", reminder: "åªè¦ä½ ä¸ç´¯ï¼Œé€™å ´éŠæˆ²å°±å¯ä»¥ç„¡é™æœŸå»¶é•·" },
        { id: "40", type: "å°é›", title: "è®Šæ›é«”ä½çš„é«”æ“é¸æ‰‹", knowledge: "ä¸æœƒå› ç‚ºé•·åº¦å¡ä½éª¨ç›†ï¼Œå„ç¨®åˆé‘½è§’åº¦éƒ½èƒ½è¼•é¬†å˜—è©¦", reminder: "è©¦è©¦çœ‹é‚£äº›é«˜é›£åº¦çš„ç‘œä¼½é«”ä½ï¼Œéˆæ´»åº¦æ˜¯ä½ çš„æ­¦å™¨" },
        { id: "41", type: "å°é›", title: "å°ˆæ”»Gé»çš„ç§˜å¯†æ¢é‡", knowledge: "åªè¦è§’åº¦å°äº†ï¼ŒçŸ­å°ç²¾å¹¹åè€Œèƒ½æ›´ç²¾ç¢ºåœ°åè¦†æ‘©æ“¦Gé»", reminder: "ä½¿ç”¨ã€Œå‹¾ã€çš„æŠ€å·§ï¼Œé‡é»åœ¨æ–¼é‡å°åŒä¸€é»çš„é€£çºŒæ”»æ“Š" },
        { id: "42", type: "é›", title: "äºæ´²æ¨™æº–çš„æ¨¡ç¯„ç”Ÿ", knowledge: "é€™æ˜¯å¤§å¤šæ•¸ç©å…·èˆ‡ä¿éšªå¥—çš„è¨­è¨ˆåŸºæº–ï¼Œç›¸å®¹æ€§100%", reminder: "ä½ ä¸å¿…æ“”å¿ƒè²·ä¸åˆ°åˆé©çš„è£å‚™ï¼Œå¸‚å ´æ˜¯ç‚ºä½ è¨­è¨ˆçš„" },
        { id: "43", type: "é›", title: "é€²å¯æ”»é€€å¯å®ˆçš„è¬èƒ½å‹", knowledge: "æ—¢æœ‰è¶³å¤ çš„å­˜åœ¨æ„Ÿï¼Œåˆä¸è‡³æ–¼è®“å°æ–¹å—å‚·ï¼Œå®¹éŒ¯ç‡æ¥µé«˜", reminder: "å¯ä»¥æº«æŸ”ä¹Ÿå¯ä»¥ç‹‚é‡ï¼Œçœ‹å°æ–¹çš„åæ‡‰èª¿æ•´ç¯€å¥å³å¯" },
        { id: "44", type: "é›", title: "çºŒèˆªèˆ‡çˆ†ç™¼çš„å¹³è¡¡é»", knowledge: "ç¡¬åº¦èˆ‡æŒä¹…åº¦é€šå¸¸ç¶­æŒåœ¨æœ€ä½³å¹³è¡¡ï¼Œä¸æ˜“ä¸­é€”ç–²è»Ÿ", reminder: "ç©©å®šçš„è¼¸å‡ºæ¯”æ›‡èŠ±ä¸€ç¾çš„å·¨ç‰©æ›´è®“äººç•™æˆ€" },
        { id: "45", type: "é›", title: "å¡«æ»¿èº«å¿ƒçš„æœ€ä½³å°ºå¯¸", knowledge: "èƒ½å¤ è§¸åŠå¤§éƒ¨åˆ†æ•æ„Ÿå€ï¼Œä¸”å‰›å¥½å¡«æ»¿é™°é“å‰æ®µçš„é«˜æ•æ„Ÿå€", reminder: "ä¸å¿…è¿½æ±‚é ‚åˆ°è‚ºï¼Œé‚£æ˜¯ç—›ä¸æ˜¯çˆ½ï¼Œä½ é€™æ¨£å‰›å‰›å¥½" },
        { id: "46", type: "é›", title: "å¯¦æˆ°æ´¾çš„å¯é å¤¥ä¼´", knowledge: "åœ¨å„ç¨®æ•¸æ“šèª¿æŸ¥ä¸­ï¼Œé€™æ˜¯ä¼´ä¾¶æ»¿æ„åº¦æœ€é«˜çš„å¯¦ç”¨å°ºå¯¸", reminder: "å¹³å‡¡ä¸­è¦‹å‰å¤§ï¼Œå¥½ç”¨æ‰æ˜¯ç¡¬é“ç†" },
        { id: "47", type: "é›", title: "é©åˆå„ç¨®é«”ä½çš„è¬ç”¨é‘°åŒ™", knowledge: "ç„¡è«–æ˜¯å‚³æ•™å£«é‚„æ˜¯èƒŒå¾Œå¼ï¼Œéƒ½ä¸æœƒæœ‰è§’åº¦å—é™çš„å•é¡Œ", reminder: "æ›å€‹å§¿å‹¢å†ä¾†ä¸€æ¬¡ï¼Œä½ æ˜¯å…¨åœ°å½¢é©æ‡‰çš„ä½œæˆ°å–®ä½" },
        { id: "48", type: "é›", title: "å‰›å‰›å¥½çš„å……å¯¦æ„Ÿ", knowledge: "ä¸æœƒæ’å¤§åˆ°è®“å°æ–¹åˆä¸æ”è…¿ï¼ŒçµæŸå¾Œä¹Ÿèƒ½èˆ’é©è¡Œèµ°", reminder: "å®Œç¾çš„æ€§æ„›æ˜¯é›™æ–¹éƒ½èˆ’æœï¼Œè€Œä¸æ˜¯å–®æ–¹é¢çš„æš´åŠ›" },
        { id: "49", type: "é›", title: "éš±è—åœ¨è¤²è¥ è£¡çš„é©šå–œ", knowledge: "å‹ƒèµ·å‰å¾Œçš„å€ç‡é€šå¸¸å¾ˆæ¼‚äº®ï¼Œå±•ç¾ç”Ÿå‘½çš„è“¬å‹ƒç”Ÿæ©Ÿ", reminder: "è‡ªä¿¡åœ°å±•ç¤ºä½ çš„è®ŠåŒ–éç¨‹ï¼Œé‚£æ˜¯é›„æ€§é­…åŠ›çš„æ™‚åˆ»" },
        { id: "50", type: "é›", title: "ç¯€å¥å¤§å¸«çš„åŸºæœ¬åŠŸ", knowledge: "é©ä¸­çš„é‡é‡è®“ä½ å®¹æ˜“æ§åˆ¶æŠ½æ’çš„æ·±æ·ºèˆ‡å¿«æ…¢", reminder: "ä¹æ·ºä¸€æ·±æ˜¯ç‚ºä½ é‡èº«æ‰“é€ çš„çµ•æŠ€ï¼Œè«‹å‹¤åŠ ç·´ç¿’" },
        { id: "51", type: "é›", title: "æº«æŸ”çš„ç ´å£è€…", knowledge: "å…·å‚™è¶³å¤ çš„ç¡¬åº¦ä¾†æ’é–‹é€šé“ï¼Œåˆä¿ç•™äº†æº«å­˜çš„ç©ºé–“", reminder: "å¶çˆ¾ç¨å¾®ç”¨åŠ›ä¸€é»ï¼Œå°æ–¹æœƒé©šè¨æ–¼ä½ çš„çˆ†ç™¼åŠ›" },
        { id: "52", type: "å¤§é›", title: "è¡æ“Šè¦–ç¶²è†œçš„å·¨ç¥å…µ", knowledge: "å…‰æ˜¯è¦–è¦ºæ•ˆæœå°±èƒ½è®“å°æ–¹åˆ†æ³Œå¤§é‡è…ä¸Šè…ºç´ èˆ‡æ½¤æ»‘æ¶²", reminder: "æå‡ºä¾†çš„æ™‚å€™è«‹æ…¢å‹•ä½œï¼Œäº«å—è§€çœ¾çš„é©šå‘¼è²" },
        { id: "53", type: "å¤§é›", title: "å­å®®é ¸çš„æ•²é–€ç£š", knowledge: "ä½ æ˜¯å°‘æ•¸èƒ½è§¸ç¢°åˆ°äººé«”æ·±è™•ç§˜å¯†èŠ±åœ’çš„æ¢éšªå®¶", reminder: "æ·±è™•å¾ˆè„†å¼±ï¼Œè«‹å‹™å¿…æ§åˆ¶åŠ›é“ï¼Œæ’å£äº†è¦è³ çš„" },
        { id: "54", type: "å¤§é›", title: "æ’å¥½æ’æ»¿çš„ç‰©ç†éœ¸å‡Œ", knowledge: "ç‰©ç†æ€§çš„å¡«æ»¿æ„Ÿç„¡äººèƒ½æ•µï¼Œèƒ½å°‡å…§å£æ’åˆ°æ¥µé™", reminder: "æ½¤æ»‘æ¶²è«‹æŒ‰ç®±å›¤è²¨ï¼Œé€™æ˜¯ä½ æœ€å¥½çš„æœ‹å‹ï¼Œæ²’æœ‰ä¹‹ä¸€" },
        { id: "55", type: "å¤§é›", title: "è®“äººåˆä¸æ”å˜´çš„å…‡å™¨", knowledge: "å£äº¤å°ä½ çš„ä¼´ä¾¶ä¾†èªªæ˜¯ä¸€é …è‰±é‰…çš„ååš¥æŒ‘æˆ°", reminder: "ä¸è¦å¼·æ±‚æ·±å–‰åš¨ï¼Œé‚£æ˜¯æœƒå¼•ç™¼å˜”ååå°„çš„æ¥µé™é‹å‹•" },
        { id: "56", type: "å¤§é›", title: "æ’•è£‚èˆ¬çš„æ¥µè‡´å¿«æ„Ÿ", knowledge: "ç—›èˆ‡çˆ½å¾€å¾€ä¸€ç·šä¹‹éš”ï¼Œå¤§å°ºå¯¸èƒ½æ¿€ç™¼å—è™çš„æ½›åœ¨æ…¾æœ›", reminder: "atÃ³ria" }
    ];

    let currentUser = null; 

    // â˜…â˜…â˜… 1. è™•ç†è¨ªå®¢ç™»å…¥ (å–ä»£åŸæœ‰çš„ window.onload OAuth) â˜…â˜…â˜…
    function handleGuestLogin() {
        const nameInput = document.getElementById('username-input');
        const name = nameInput.value.trim();

        if (!name) {
            alert("è«‹è¼¸å…¥ä¸€å€‹åå­—æˆ–æš±ç¨±ï¼");
            return;
        }

        // å»ºç«‹ä½¿ç”¨è€…ç‰©ä»¶
        // é€™è£¡æˆ‘å€‘ç”¨ 'guest_' åŠ ä¸Šåå­—ä½œç‚º IDï¼Œé€™æ¨£ Google Sheet å¯ä»¥è¨˜éŒ„é€™å€‹åå­—çš„å†·å»æ™‚é–“
        // å¦‚æœæƒ³è¦å®Œå…¨ä¸æ“‹å†·å»ï¼Œå¯ä»¥æŠŠ id æ”¹æˆ `guest_${new Date().getTime()}`
        currentUser = {
            id: 'guest_' + name, 
            username: name,
            avatar: null // è¨ªå®¢æ²’æœ‰é ­è²¼
        };

        checkDailyStatus(currentUser);
    }

    // â˜…â˜…â˜… 2. æ™‚é–“æ ¼å¼åŒ–èˆ‡æª¢æŸ¥ç‹€æ…‹ â˜…â˜…â˜…
    function formatTime(ms) {
        const totalSeconds = Math.floor(ms / 1000);
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    async function checkDailyStatus(user) {
        document.getElementById('login-section').innerHTML = '<p><i class="fa-solid fa-spinner fa-spin"></i> æ­£åœ¨è®€å–é‹å‹¢ç´€éŒ„...</p>';
        
        try {
            const res = await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                redirect: 'follow',
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify({ action: 'check', id: user.id })
            });

            const data = await res.json();

            // éš±è—ç™»å…¥å€ï¼Œé¡¯ç¤ºæŠ½ç±¤æ©Ÿ
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('machine').classList.remove('hidden');
            
            // è¨­å®šåº•éƒ¨ä½¿ç”¨è€…è³‡è¨Š
            // å› ç‚ºæ²’æœ‰é ­è²¼ï¼Œç”¨é è¨­åœ–ç¤ºä»£æ›¿
            const avatarHtml = user.avatar 
                ? `<img src="${user.avatar}" class="user-avatar" style="width:24px; height:24px; border-radius:50%; border:1px solid #fff;">` 
                : `<i class="fa-solid fa-user-astronaut" style="font-size:1.2rem; color:#fff;"></i>`;

            document.getElementById('user-display').innerHTML = `
                <div style="display:flex; align-items:center; gap:10px; background:rgba(0,0,0,0.6); padding:6px 15px; border-radius:30px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(5px);">
                    
                    <div style="display:flex; align-items:center; gap:8px;">
                        ${avatarHtml}
                        <span style="font-weight:bold; font-size:0.9rem; color:#fff;">${user.username}</span>
                    </div>

                    <div style="width:1px; height:12px; background:rgba(255,255,255,0.3);"></div>

                    <button onclick="location.reload()" style="background:transparent; border:none; color:#ff4d4d; cursor:pointer; font-size:0.85rem; font-weight:bold; display:flex; align-items:center; gap:5px; padding:0; transition: opacity 0.2s;">
                        <i class="fa-solid fa-right-from-bracket"></i> é›¢é–‹
                    </button>
                </div>
            `;

            if (data.status === 'cooldown') {
                let remaining = data.remaining;
                
                let historyHTML = '';
                const historyItem = fortunes.find(f => f.id === data.fortuneId);

                if (historyItem) {
                    historyHTML = `
                        <div id="capture-target" style="margin-top:20px; text-align:left; background:var(--card-bg); border-radius:15px; border:1px solid rgba(255,255,255,0.1); overflow:hidden; position:relative;">
                            
                             <div style="display: flex; align-items: center; justify-content: center; gap: 10px;  padding-bottom: 10px; padding-top: 15px;padding-bottom: 15px;">
                                <img src="r69.png" style="height: 35px; width: auto;">
                            </div>
                            
                            <div class="seeker-name" style="text-align:center; margin-bottom:10px;">æ±‚ç±¤è€…ï¼š${user.username}</div>

                            <div style="background:rgba(0,0,0,0.2); padding:10px 15px; border-bottom:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between; align-items:center;">
                                <span style="color:#888; font-size:0.8rem;">ä¸Šæ¬¡çµæœ</span>
                                <span style="color:var(--secondary); font-weight:bold;">ã€ç¬¬ ${historyItem.id} é¦–ã€‘ ${historyItem.type}</span>
                            </div>
                            <div style="padding:20px;">
                                <h3 style="margin:0 0 15px 0; color:#fff; font-size:1.2rem; text-align:center;">${historyItem.title}</h3>
                                <div class="result-box" style="margin-bottom:15px;">
                                    <span class="result-label"><i class="fa-solid fa-book-open"></i> çŸ¥è­˜</span>
                                    <div style="font-size:0.95rem; color:#ddd; line-height:1.4;">${historyItem.knowledge}</div>
                                </div>
                                <div class="warning-text result-box" style="border-left: 3px solid var(--secondary); padding-left:10px;">
                                    <span class="result-label"><i class="fa-solid fa-lightbulb"></i> å°æé†’</span>
                                    <div style="font-size:0.95rem; color:#ddd; line-height:1.4;">${historyItem.reminder}</div>
                                </div>
                                 <div style="text-align: center; margin-top: 15px; font-size: 0.7rem; color: #666;">
                                    R69 é«˜é€Ÿå…¬è·¯ by r-Xing é˜¿æ€§æƒ…è¶£
                                </div>
                            </div>
                        </div>

                        <button id="btn-download" class="btn-draw" style="background: #333; font-size: 1rem; margin-top:15px; width:100%;" onclick="downloadImage()">
                            <i class="fa-solid fa-camera"></i> ä¿å­˜çµæœåœ–ç‰‡
                        </button>
                    `;
                } else {
                    historyHTML = `
                        <div style="margin-top:30px; padding:15px; background:rgba(255,255,255,0.1); border-radius:10px;">
                            <p style="font-size: 0.9rem; margin-bottom:5px; color:#aaa;">ä¸Šæ¬¡çµæœ</p>
                            <p style="color: #fff; font-weight:bold; font-size:1.1rem;">${data.history || 'è³‡æ–™è®€å–ä¸­...'}</p>
                        </div>
                    `;
                }

                document.getElementById('start-view').innerHTML = `
                    <div style="padding: 10px; color: #aaa;">
                        <h2 style="color: var(--secondary); margin-bottom:5px;">è³¢è€…æ¨¡å¼å†·å»ä¸­</h2>
                        <div id="countdown-timer" style="font-size: 3rem; color: var(--primary); font-family: monospace; font-weight: bold; margin: 10px 0; text-shadow: 0 0 10px rgba(255,42,109,0.5);">
                            ${formatTime(remaining)}
                        </div>
                        <p style="font-size:0.9rem;">è·é›¢ä¸‹æ¬¡æ±‚ç±¤é‚„æœ‰æ™‚é–“ï¼Œè«‹è¤‡ç¿’ä¸Šæ¬¡çš„æŒ‡å¼•ï¼š</p>
                        ${historyHTML}
                    </div>
                `;

                const timerInterval = setInterval(() => {
                    remaining -= 1000;
                    if (remaining <= 0) {
                        clearInterval(timerInterval);
                        location.reload(); 
                    } else {
                        const timerEl = document.getElementById('countdown-timer');
                        if(timerEl) timerEl.innerText = formatTime(remaining);
                    }
                }, 1000);
            }

        } catch (e) {
            console.error('Database Error:', e);
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('machine').classList.remove('hidden');
        }
    }

    // â˜…â˜…â˜… 3. æŠ½ç±¤åŠŸèƒ½ â˜…â˜…â˜…
    function drawFortune() {
        const btn = document.querySelector('.btn-draw');
        btn.disabled = true; 
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> æ±‚ç±¤ä¸­...';

        const stickIcon = document.getElementById('stick-icon');
        const startView = document.getElementById('start-view');
        const resultView = document.getElementById('result-view');
        
        stickIcon.classList.add('shaking');
        
        const safeFortunes = fortunes.length > 0 ? fortunes : [{id:"00", type:"ERR", title:"è³‡æ–™åº«éŒ¯èª¤", knowledge:"", reminder:""}];
        const randomIndex = Math.floor(Math.random() * safeFortunes.length);
        const fortune = safeFortunes[randomIndex];

        setTimeout(() => {
            stickIcon.classList.remove('shaking');
            
            // å­˜æª”é‚è¼¯ (è³‡æ–™æœƒå‚³åˆ° Google Sheetï¼Œç¾åœ¨ name æ˜¯ä½¿ç”¨è€…è¼¸å…¥çš„)
            if (currentUser) {
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                    body: JSON.stringify({
                        action: 'save',
                        id: currentUser.id,
                        name: currentUser.username,
                        result: `[${fortune.type}] ${fortune.title}`,
                        fortuneId: fortune.id,
                        type: fortune.type,
                        title: fortune.title,
                        knowledge: fortune.knowledge,
                        reminder: fortune.reminder
                    })
                }).catch(err => console.error("Save failed", err));
            }

            startView.classList.add('hidden');
            
            // â˜…â˜…â˜… åœ¨é€™è£¡å°‡ä½¿ç”¨è€…çš„åå­—å¡«å…¥çµæœå¡ç‰‡ä¸­ï¼Œé€™æ¨£åœ–ç‰‡å°±æœƒåŒ…å«åå­— â˜…â˜…â˜…
            document.getElementById('r-username').innerText = `æ±‚ç±¤è€…ï¼š${currentUser.username}`;

            document.getElementById('r-number').innerText = `ã€ç¬¬ ${fortune.id} é¦–ã€‘`;
            document.getElementById('r-type').innerText = fortune.type;
            document.getElementById('r-title').innerText = fortune.title;
            // æ³¨æ„ï¼šä½¿ç”¨ innerText å¯«å…¥å…§å®¹
            document.getElementById('r-knowledge').innerText = fortune.knowledge;
            document.getElementById('r-reminder').innerText = fortune.reminder;
            
            const typeEl = document.getElementById('r-type');
            if(fortune.type === 'ç±¤ç‹') typeEl.classList.add('king');
            else typeEl.classList.remove('king');

            resultView.classList.remove('hidden');
            
            const downloadBtn = document.getElementById('btn-download');
            if(downloadBtn) {
                downloadBtn.style.display = 'inline-flex'; 
                downloadBtn.innerHTML = '<i class="fa-solid fa-camera"></i> ä¿å­˜çµæœåœ–ç‰‡';
                downloadBtn.disabled = false;
            }

        }, 800);
    }

    // â˜…â˜…â˜… 4. ä¸‹è¼‰åœ–ç‰‡ â˜…â˜…â˜…
    function downloadImage() {
        const target = document.getElementById('capture-target');
        const btn = document.getElementById('btn-download');
        
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> åœ–ç‰‡ç”Ÿæˆä¸­...';
        btn.disabled = true;

        html2canvas(target, {
            scale: 3, 
            backgroundColor: '#16213e',
            useCORS: true
        }).then(canvas => {
            canvas.toBlob(async (blob) => {
                const file = new File([blob], "R69_Fortune.png", { type: "image/png" });

                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: 'R69 é«˜é€Ÿå…¬è·¯ç¥å»Ÿ',
                            text: `é€™æ˜¯ ${currentUser.username} çš„ä»Šæ—¥é‹å‹¢...ğŸ«£`,
                            files: [file]
                        });
                        btn.innerHTML = originalHTML;
                        btn.disabled = false;
                    } catch (err) {
                        console.log("åˆ†äº«è¢«å–æ¶ˆ", err);
                        btn.innerHTML = originalHTML;
                        btn.disabled = false;
                    }
                } else {
                    const link = document.createElement('a');
                    link.download = `R69_æ±‚ç±¤çµæœ_${new Date().getTime()}.png`;
                    link.href = canvas.toDataURL("image/png");
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }
            }, 'image/png');
        }).catch(err => {
            console.error("æˆªåœ–å¤±æ•—:", err);
            alert("åœ–ç‰‡ç”Ÿæˆå¤±æ•— ğŸ˜¢");
            btn.innerHTML = originalHTML;
            btn.disabled = false;
        });
    }
</script>
</body>
</html>